{"version":3,"sources":["api/schm/schm.controller.js"],"names":[],"mappings":"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","file":"api/schm/schm.controller.js","sourcesContent":["/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/schms              ->  index\n * POST    /api/schms              ->  create\n * GET     /api/schms/:id          ->  show\n * PUT     /api/schms/:id          ->  update\n * DELETE  /api/schms/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport Schm from './schm.model';\nimport q from 'q';\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function(entity) {\n    var updated = _.merge(entity, updates);\n    return updated.save()\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function(entity) {\n    if (entity) {\n      return entity.remove()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function(entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    res.status(statusCode).send(err);\n  };\n}\nfunction checkParam(param, dataType) {\n\n  if(param === null){ return false; }\n  var response = false;\n  \n  if(dataType === 'string'){\n    if(typeof param === 'string' && param.length>0){\n      response = true;\n    }\n  }\n\n  if(dataType === 'number'){\n    //console.log('chequea numero')\n    if(typeof param === 'number'){\n      response = true;\n    }\n    if(typeof param === 'string'){\n      \n      if(/^\\d*$/.test( param )){\n        //console.log('es  numero')\n        response = true;\n      }\n    }\n  }\n\n  if(dataType === 'objectId'){\n    if(/^[0-9a-f]{24}$/i.test(param)){\n      response = true;\n    }\n  }\n\n  //filtro de registros\n  if (dataType === 'filter') {\n    //checkeando si hay errores en el parseo a JSON\n    try {\n      var arr = JSON.parse(param);\n      //check if is an Array and if is empty\n      if(arr.length){\n        // verificando si los obj dentro del array tiene las propiedades key, datatype y value\n        var isValid = true;\n        for (var index = 0; index < arr.length; index++) {\n          if(arr[index].key === null || arr[index].value === null || arr[index].datatype === null){\n            isValid = false;\n          }\n        }\n        response = isValid;\n      }\n\n    } catch (err) {\n      response = false;\n      console.log('invalid JSON')\n    }\n  }\n\n  return response;\n}\n\n// Gets a list of Schms\nexport function index(req, res) {\n\n  var items = req.query.items || 30;\n  var page = req.query.page || 1;\n  // checking the query data types\n  if(!checkParam(page, 'number') || page === \"0\" ){\n    return respondWithResult(res, 500)({Error:'El par치metro page no es v치lido'});\n  }\n  if(!checkParam(items, 'number') ){\n    return respondWithResult(res, 500)({Error:'El par치metro items no es v치lido'});\n  }\n  \n  var query = {};\n  //filtrar por schm\n  if(checkParam(req.query.schm, 'objectId')){\n    query.schm = req.query.schm;\n    //console.log('schm')\n  }\n\n  if(checkParam(req.query.filter, 'filter')){\n    query[\"$and\"] = [];\n    \n    var filter = JSON.parse(req.query.filter);\n    for (var i = 0; i < filter.length; i++) {\n      var p = {attributes:{}};\n      p[\"attributes\"][\"$elemMatch\"] = {};\n      p[\"attributes\"][\"$elemMatch\"]['id'] = filter[i].key;\n      p[\"attributes\"][\"$elemMatch\"][filter[i].datatype] = filter[i].value;\n      query[\"$and\"].push(p);\n    }\n    //console.log(filter);\n  }\n\n\n  q.all([\n    Schm.find(query).count().exec(),\n    Schm.find(query).skip(items*(page-1)).limit(items)\n  ]).spread( (count, data) =>{\n    respondWithResult(res)({\n        page:parseInt(page),\n        pages:Math.ceil(count/items),\n        length: data.length,\n        totalLength: count,\n        items:data\n      });\n  }).fail(handleError(res));\n  /*\n  return Schm.find().exec()\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n  */\n}\n\n// function helper\nvar findValueByVarHelper = function(array, key, value, target){\n    var self = this;\n    if(!Array.isArray(array)){return null;}\n\n    var index = array.map(x=> x[key] ).indexOf(value);\n    \n    if(index !== -1){\n        if(target === undefined){\n            return array[index];\n        }else{\n            return array[index][target];\n        }\n    }else{\n        return null;\n    }\n}\nexport function fullSchm (schmId){\n  var firstCall = function(s){\n    var query = { type:\"schmAttrInputConf\", attributes:{  \"$elemMatch\":{id:\"schema\", reference:schmId}  }   }\n          return q.all([\n        Schm.findById(schmId),\n        Schm.find(query)\n      ]).spread( (schm,schmAttrInputConf) =>{\n        var index = schm.attributes.map(x=>x.id).indexOf(\"attributes\");\n        var AttrList = [];\n        if(index!==-1){AttrList = schm.attributes[index].list}\n\n        return {\n          schema:schm,\n          schmAttrInputConf:schmAttrInputConf,\n          list: AttrList\n        }\n        \n      })\n\n    }\n  var secondCall = function(d){\n      var query = {\"$or\":[]};\n      for (var i = 0; i < d.list.length; i++) {\n        query[\"$or\"].push({ _id: d.list[i] });\n      }\n      d.query = query;\n      return d\n      \n    }\n  var thirdCall = function(d){\n      return Schm.find(d.query).then(function(s){\n        d.attributes = s;\n        return d\n      })\n    }\n  var forthCall = function(d){\n      var inputRefs = d.attributes.map(x=>findValueByVarHelper(x.attributes,\"id\", \"input\", \"reference\"));\n      var queryInputs = {\"$or\":[]};\n        for (var i = 0; i < inputRefs.length; i++) {\n          queryInputs[\"$or\"].push({ _id: inputRefs[i] });\n        }\n      console.log(inputRefs);\n      //d.queryInputs = queryInputs;\n      return Schm.find(queryInputs).then(function(s){\n          d.inputs = s;\n          return d\n        })\n    }\n  var concatCall  = function(d){\n    var concat = [d.schema];\n    concat = concat.concat(d.attributes);\n    concat = concat.concat(d.schmAttrInputConf);\n    concat = concat.concat(d.inputs);\n    return concat;\n  }\n\n  return q.fcall(x=>true)\n    .then(firstCall)\n    .then(secondCall)\n    .then(thirdCall)\n    .then(forthCall)\n    .then(concatCall)\n}\n\n\n// Gets a single Schm from the DB\nexport function show(req, res) {\n  /*var schmId = req.params.id;\n  // obtener schema y schmAttrInputConf\n  \n  var firstCall = function(s){\n    var query = { type:\"schmAttrInputConf\", attributes:{  \"$elemMatch\":{id:\"schema\", reference:schmId}  }   }\n          return q.all([\n        Schm.findById(schmId),\n        Schm.find(query)\n      ]).spread( (schm,schmAttrInputConf) =>{\n        var index = schm.attributes.map(x=>x.id).indexOf(\"attributes\");\n        var AttrList = [];\n        if(index!==-1){AttrList = schm.attributes[index].list}\n\n        return {\n          schema:schm,\n          schmAttrInputConf:schmAttrInputConf,\n          list: AttrList\n        }\n        \n      })\n\n    }\n  var secondCall = function(d){\n      var query = {\"$or\":[]};\n      for (var i = 0; i < d.list.length; i++) {\n        query[\"$or\"].push({ _id: d.list[i] });\n      }\n      d.query = query;\n      return d\n      \n    }\n  var thirdCall = function(d){\n      return Schm.find(d.query).then(function(s){\n        d.attributes = s;\n        return d\n      })\n    }\n  var forthCall = function(d){\n      var inputRefs = d.attributes.map(x=>findValueByVarHelper(x.attributes,\"id\", \"input\", \"reference\"));\n      var queryInputs = {\"$or\":[]};\n        for (var i = 0; i < inputRefs.length; i++) {\n          queryInputs[\"$or\"].push({ _id: inputRefs[i] });\n        }\n      console.log(inputRefs);\n      //d.queryInputs = queryInputs;\n      return Schm.find(queryInputs).then(function(s){\n          d.inputs = s;\n          return d\n        })\n    }\n  var concatCall  = function(d){\n    var concat = [d.schema];\n    concat = concat.concat(d.attributes);\n    concat = concat.concat(d.schmAttrInputConf);\n    concat = concat.concat(d.inputs);\n    return concat;\n  }\n  q.fcall(x=>true)\n    .then(firstCall)\n    .then(secondCall)\n    .then(thirdCall)\n    .then(forthCall)\n    .then(concatCall)*/\n    fullSchm(req.params.id)\n    .then(function(d){\n      respondWithResult(res)(d);\n    }) \n    .fail(handleError(res));\n\n}\n\n\n\n// Creates a new Schm in the DB\nexport function create(req, res) {\n  return Schm.create(req.body)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\n// Updates an existing Schm in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  return Schm.findById(req.params.id).exec()\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Schm from the DB\nexport function destroy(req, res) {\n  return Schm.findById(req.params.id).exec()\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\n/*\n\"_id\" : ObjectId(\"57a4e152c830e2bdff1a160a\"), \n    \"name\" : \"cruzamientos\", \n\n\n\n    \"_id\" : ObjectId(\"57a4e3cac830e2bdff1a160c\"), \n    \"name\" : \"parentales\", \n\n\n    \"_id\" : ObjectId(\"57a4e02ec830e2bdff1a1608\"), \n    \"name\" : \"individuos\", \n\n\n  \"_id\" : ObjectId(\"57a3a35bc830e2bdff1a1606\"), \n      \"name\" : \"fenotipado\", ?????\n*/"],"sourceRoot":"/source/"}